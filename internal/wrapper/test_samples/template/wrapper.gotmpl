// Code generated by sirish. DO NOT EDIT.
// THIS FILE IS ONLY A TEST FOR SIRISH PACKAGE. NOT USABLE FOR PRODUCTION NEEDS.
// Version {{ .Version }}

package {{ .Interface.Package }}

{{- $iface := .Interface -}}
{{- $typeBaseString := printf "%sWrapper" .TypeName -}}
{{- $wrapperName := printf "%sImpl" $typeBaseString -}}

{{- /* IMPORTS SECTION */}}
{{- if .Imports }}
import (
    {{ range $path, $alias := .Imports }}
        {{- if eq $alias "" }}
        "{{ $path }}"
        {{- else }}
        {{ $alias }} "{{ $path }}"
        {{- end }}
    {{- end }}
)
{{- end }}

{{/* ---------- WRAPPER TYPE ---------- */}}
type {{ $wrapperName }} struct {
    // TODO: Visitor supports generics. add generics to template
    name          string
    wrapped       {{ $iface.Name }}
    interfaceName string
    tagType       string
}

{{/* ---------- CONSTRUCTOR ---------- */}}
func New{{$wrapperName}}(
    name string,
    wrapped {{$iface.Name}},
    tagType string,
) *{{$wrapperName}} {

    return &{{$wrapperName}}{
    name:           name,
    tagType:        tagType,
    interfaceName:  "{{ .Interface.Name }}",
    wrapped:        wrapped,
    }
}

{{/* ---------- METHODS ---------- */}}
{{- range $m := $iface.Methods }}

func (w *{{ $wrapperName }}) {{$m.Name}}({{$m.ParamsOverallNames}}) {{- if $m.Results }} (
    {{- if $m.HasNamedResult }}{{$m.ResultOverallNames}}{{- else}}{{$m.ResultTypesNames}}{{- end}}){{ end }} {

    var span *apm.Span
    {{- if $m.HasCtx }}
    span, {{$m.CtxName}} = apm.StartSpan({{$m.CtxName}}, "{{$m.SpecialName}}", w.tagType)
    defer span.End()
    {{- else }}
    tx := apm.DefaultTracer().StartTransaction("{{$m.SpecialName}}", w.tagType)
    defer tx.End()
    span, _ = apm.StartSpan(apm.ContextWithTransaction(context.Background(), tx), "{{printf "%sSpan" $m.Name}}", w.tagType)
    defer span.End()
    {{- end}}

    {{- /* Call underlying method */}}
    {{- if $m.Results }}
        {{- if $m.HasNamedResult }}
    {{$m.ResultNames}} = w.wrapped.{{$m.Name}}({{$m.ParamsNames}})
        {{- else }}
    {{$m.ResultNames}} := w.wrapped.{{$m.Name}}({{$m.ParamsNames}})
        {{- end}}
    {{- else}}
    w.wrapped.{{$m.Name}}({{$m.ParamsNames}})
    return
    {{- end}}
    {{- if $m.Results}}
    return {{$m.ResultNames}}
    {{- end}}
}
{{ end }}
